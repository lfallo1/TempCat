angular.module("expenseApp").directive("image",["$q",function(a){"use strict";var b=window.URL||window.webkitURL,c=function(){var a="fileupload-resize-area",b=document.getElementById(a);return b||(b=document.createElement("canvas"),b.id=a,b.style.visibility="hidden",document.body.appendChild(b)),b},d=function(a,b){var d=b.resizeMaxHeight||300,e=b.resizeMaxWidth||250,f=b.resizeQuality||.7,g=b.resizeType||"image/jpg",h=c(),i=a.height,j=a.width;j>i?j>e&&(i=Math.round(i*=e/j),j=e):i>d&&(j=Math.round(j*=d/i),i=d),h.width=j,h.height=i;var k=h.getContext("2d");return k.drawImage(a,0,0,j,i),h.toDataURL(g,f)},e=function(a,b){var c=new Image;c.onload=function(){b(c)},c.src=a},f=function(b){var c=a.defer(),d=new FileReader;return d.onload=function(a){c.resolve(a.target.result)},d.readAsDataURL(b),c.promise};return{restrict:"A",scope:{image:"=",resizeMaxHeight:"@?",resizeMaxWidth:"@?",resizeQuality:"@?",resizeType:"@?"},link:function(a,c,g){var h=function(b,c){e(b.url,function(e){var f=d(e,a);b.resized={dataURL:f,type:f.match(/:(.+\/.+);/)[1]},c(b)})},i=function(b){a.$apply(function(){g.multiple?a.image.push(b):a.image=b})};c.bind("change",function(c){g.multiple&&(a.image=[]);for(var d=c.target.files,e=0;e<d.length;e++){var j={file:d[e],url:b.createObjectURL(d[e])};f(d[e]).then(function(a){j.dataURL=a}),a.resizeMaxHeight||a.resizeMaxWidth?h(j,function(a){i(a)}):i(j)}})}}}]);