"use strict";angular.module("expenseApp.Controllers").controller("EmployeeTableController",["$scope","$location","$modal","$route","$rootScope","$filter","Application","SubmissionService","MessageService","ReceiptService",function(a,b,c,d,e,f,g,h,i,j){var k=[];a.statuses=[{name:"All",value:"0"},{name:"In Progress",value:"1"},{name:"Submitted",value:"2"},{name:"Manager Approved",value:"3"},{name:"Manager Rejected",value:"4"},{name:"Finance Approved",value:"5"},{name:"Finance Rejected",value:"6"}],a.expanded=!0;var l=f("orderBy"),m={field:"DateCreated",reverse:!1};a.expandContract=function(b){a.expanded=b},a.employeeOrder=function(b){b===m.field?(m.reverse=!m.reverse,a.employeeSubmissions=l(a.employeeSubmissions,m.field,m.reverse)):(m.field=b,m.reverse=!1,a.employeeSubmissions=l(a.employeeSubmissions,m.field,m.reverse))},a.selectedStatus=a.statuses[0],a.loadEmployeeTable=function(){if(void 0!=g.getAllUserSubmissions()){var b=0,c=g.getAllUserSubmissions();a.employeeSubmissions=g.getAllUserSubmissions();for(var d=0;d<c.length;d++){for(var f=[],i=0;i<c[d].LineItems.length;i++)for(var j=0;j<c[d].LineItems[i].Receipts.length;j++)f.push(c[d].LineItems[i].Receipts[j]);c[d].allSubmissionReceipts=f}k=a.employeeSubmissions;for(var d=0;d<a.employeeSubmissions.length;d++)(4==a.employeeSubmissions[d].StatusId||6==a.employeeSubmissions[d].StatusId)&&b++;e.$broadcast("employeeTotal",b)}else h.getSubmissionsByUsername().then(function(b){for(var c=0,d=b.data,f=0;f<d.length;f++){(4==d[f].StatusId||6==d[f].StatusId)&&c++;for(var h=[],i=0;i<d[f].LineItems.length;i++)for(var j=0;j<d[f].LineItems[i].Receipts.length;j++)h.push(d[f].LineItems[i].Receipts[j]);d[f].allSubmissionReceipts=h,d[f].ReceiptPresent=h.length>0?!0:!1}g.setAllUserSubmissions(d),a.employeeSubmissions=g.getAllUserSubmissions(),e.$broadcast("employeeTotal",c),k=a.employeeSubmissions})},a.loadEmployeeTable(),a.loadEmployeeTableStatusX=function(b){for(var c=[],d=0;d<k.length;d++)(k[d].StatusId==b||0==b)&&c.push(k[d]);a.employeeSubmissions=c},a.loadEmployeeSubmission=function(c,d){a.dt1="",g.setSubmission(c),g.setSubmissionStatus(c.Status.StatusId),g.setOrigin("EmployeeTable"),g.setSubmissionIndex(d),j.setAllReceipts(c.allSubmissionReceipts),b.path("/submission")},a.deleteSubmission=function(b,d){g.setSubmissionIndex(d),i.setMessage("Are you sure you want to delete this submission?"),i.setBroadCastMessage("confirmDeleteSubmission"),i.setId(b.SubmissionId);c.open({templateUrl:"Views/HotTowel/views/modals/confirmModal.html",controller:"confirmModalController",resolve:{selectedType:function(){return a.selectedType}}})},a.showAllAvailableReceipts=function(a,b,d){j.setReceipts(a),j.setShowAllReceipts(!0),g.setSubmission(b),g.setSubmissionIndex(d),j.setAddReceipt(!1);c.open({templateUrl:"Views/HotTowel/views/modals/receiptModal.html",controller:"receiptController"})},a.$on("confirmDeleteSubmission",function(){i.setMessage(""),i.setBroadCastMessage(""),h.deleteExpenseReport(i.getId()).then(function(){a.employeeSubmissions.splice(g.getSubmissionIndex(),1),g.setAllUserSubmissions(a.employeeSubmissions)},function(){})}),a.$on("addSubmissionEmployeeTable",function(){a.employeeSubmissions=g.getAllUserSubmissions()})}]);