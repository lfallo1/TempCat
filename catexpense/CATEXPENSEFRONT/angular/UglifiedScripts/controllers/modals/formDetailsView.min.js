"use strict";angular.module("expenseApp.Controllers").controller("FormDetailsCtrl",["$scope","$modalInstance","$modal","$rootScope","LineItemService","ValidationService","Application","ReceiptService",function(a,b,c,d,e,f,g,h){function i(a,c){if(0===a.length)console.log(c);else{console.log("Successfully saved report(s)");for(var d=0;d<a.length;d++)delete a[d].valid;b.close(a)}}function j(a,c,d){var e=[];e.push(a),c?(console.log("Successfully saved report(s)"),b.close(e)):console.log(d)}function k(a,c,d){var e=[];e.push(a),c?(console.log("Successfully saved report(s)"),b.close(e)):console.log(d)}function l(a){for(var b=[],c=0;c<a.length;c++){var d={};d.Billable=a[c].billable,d.ExpenseCategoryId=1,d.LineItemAmount=a[c].amount,d.LineItemDate=a[c].date,d.LineItemDesc=a[c].description,d.LineItemMetadata="Miles:"+a[c].miles+",Origin:"+a[c].origin+",Destination:"+a[c].destination+",Sunday:false,Monday:false,Tuesday:false,Wednesday:false,Thursday:false,Friday:false,Saturday:false",d.StatusId=1,d.SubmissionId=e.getSubmissionId(),d.valid=a[c].valid,b.push(d)}return b}a.divShow=!1,a.formTypes=["Mileage","Per Diem","Transportation","Lodging","Parking","Entertainment","Meals","Airfare","Other"],a.mileageArray=[],a.selectedType=e.getExpenseCategoryName(),a.editingLineItem=e.getUnderEdit(),a.addNewReceipt=!1,a.displayMileageForm=function(){return"Mileage"===a.selectedType},a.displayPerDiemForm=function(){return"Per Diem"===a.selectedType},a.displayOtherForm=function(){return a.displayMileageForm()===!1&&a.displayPerDiemForm()===!1},a.resetValues=function(){e.setExpenseCategoryName(a.selectedType)},a.getPolicy=function(){c.open({templateUrl:"Views/HotTowel/views/modals/policyView.html",controller:"PolicyCtrl",resolve:{selectedType:function(){return a.selectedType}}})},a.saveNew=function(){var b=[],c="please create a "+a.selectedType+" expense.";switch(h.setAddReceipt(a.addNewReceipt),a.selectedType){case"Mileage":b=l(a.mileageArray),i(b,c);break;case"Per Diem":j(e.getLineItem(),e.isLineItemValid(),c);break;default:k(e.getLineItem(),e.isLineItemValid(),c)}},a.saveEdit=function(){{var c;"please fix your "+a.selectedType+" expense."}switch(a.selectedType){case"Mileage":c=l(a.mileageArray);break;default:c=e.getLineItem()}e.isLineItemValid()?(console.log("Successfully edited report"),b.close(e.getLineItem())):console.log("invalid expense")},a.cancel=function(){b.dismiss("Form was cancelled.")},a.checkFile=function(){$("#upload").prop("disabled",!0===$("input:file").val()),a.divShow=!1},a.upload=function(){if(a.noReceipt=!1,a.image){var b=a.image.dataURL+"",c=b.substring(b.indexOf(",")+1),f={LineItemId:e.getLineItemId(),Base64String:c,Name:a.image.file.name,Type:a.image.file.type};h.submitReceipt(f).then(function(b){$("#upload").prop("disabled",!0),a.divShow=!0,d.$broadcast("addNewReceipt",b.data),a.image=void 0})}else $("#upload").prop("disabled",!0),a.noReceipt=!0}}]);