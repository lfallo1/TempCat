"use strict";angular.module("expenseApp.Controllers").controller("receiptController",["$scope","$modalInstance","ReceiptService","$rootScope","MessageService","$modal","Application","$route","LineItemService",function(a,b,c,d,e,f,g,h,i){var j=0,k=0,l=!1;a.canDelete=!0,a.hover=!1,a.userReceipts=c.getReceipts(),a.createNewReceipt=c.getAddReceipt(),c.getShowAllReceipts()&&(l=!0),("ManagerTable"==g.getOrigin()||"FinanceTable"==g.getOrigin())&&(a.canDelete=!1),a.downloadFile=function(a){c.getReceiptById(a)},a.deleteReceipt=function(a,b){j=a,k=b,e.setMessage("Are you sure you want to delete this receipt?"),e.setBroadCastMessage("confirmDeleteReceipt");f.open({templateUrl:"Views/HotTowel/views/modals/confirmModal.html",controller:"confirmModalController"})},a.$on("confirmDeleteReceipt",function(){e.setMessage(""),e.setBroadCastMessage(""),c.deleteReceipt(j,a.userReceipts[k].LineItemId).then(function(){var d=g.getAllUserSubmissions();i.getLineItemsBySubmissionId(g.getSubmission().SubmissionId).then(function(e){a.userReceipts.splice(k,1);var f=e.data;d[g.getSubmissionIndex()].LineItems=f,c.setReceipts(a.userReceipts);for(var h=[],i=0;i<f.length;i++)if(f[i].Receipts.length>0)for(var j=0;j<f[i].Receipts.length;j++)h.push(f[i].Receipts[j]);c.setAllReceipts(h),d[g.getSubmissionIndex()].allSubmissionReceipts=h,0==h.length&&(d[g.getSubmissionIndex()].ReceiptPresent=!1),0==a.userReceipts.length&&b.dismiss("dismiss receipt modal"),g.setAllUserSubmissions(d)})})}),a.checkFile=function(){$("#upload").prop("disabled",!0===$("input:file").val()),a.divShow=!1},a.upload=function(){if(a.noReceipt=!1,a.image){var b=a.image.dataURL+"",e=b.substring(b.indexOf(",")+1),f={LineItemId:i.getLineItemId(),Base64String:e,Name:a.image.file.name,Type:a.image.file.type};c.submitReceipt(f).then(function(b){$("#upload").prop("disabled",!0),a.divShow=!0,d.$broadcast("addNewReceipt",b.data),a.image=void 0})}else $("#upload").prop("disabled",!0),a.noReceipt=!0}}]);