"use strict";angular.module("expenseApp.Controllers").controller("FinanceTableController",["$scope","$location","$modal","$route","$rootScope","$filter","Application","SubmissionService","MessageService","Authentication","ReceiptService",function(a,b,c,d,e,f,g,h,i,j,k){var l=f("orderBy"),m={field:"TotalAmount",reverse:!1};a.isFinanceApprover=j.getIsFinanceApprover(),a.expanded=!0,a.expandContract=function(b){a.expanded=b},a.financeOrder=function(b){b===m.field?(m.reverse=!m.reverse,a.financeSubmissions=l(a.financeSubmissions,m.field,m.reverse)):(m.field=b,m.reverse=!1,a.financeSubmissions=l(a.financeSubmissions,m.field,m.reverse))},a.financeStatuses=[{name:"All",value:"0"},{name:"Manager Approved",value:"3"}],a.selectedFinanceStatus=a.financeStatuses[1];var n=[];j.getIsFinanceApprover()&&o();var o=function(){void 0!=g.getPendingSubmissionsByFinanceApprover()&&0!=g.getPendingSubmissionsByFinanceApprover().length?(a.financeSubmissions=g.getPendingSubmissionsByFinanceApprover(),n=a.financeSubmissions,e.$broadcast("financeTotal",a.financeSubmissions.length)):h.getPendingSubmissionsByFinanceApprover().then(function(b){b.data.length>0&&g.setPendingSubmissionsByFinanceApprover(b.data),a.financeSubmissions=b.data,n=a.financeSubmissions,a.loadFinanceTableStatusX(3),e.$broadcast("financeTotal",a.financeSubmissions.length)})};a.loadFinanceTableStatusX=function(b){for(var c=[],d=0;d<n.length;d++)(n[d].StatusId==b||0==b)&&c.push(n[d]);0!=c.length&&(a.financeSubmissions=c)},a.loadFinaceSubmission=function(a,c){g.setSubmission(a),g.setSubmissionStatus(a.Status.StatusId),g.setOrigin("FinanceTable"),g.setSubmissionIndex(c);for(var d=[],e=0;e<a.LineItems.length;e++)for(var f=0;f<a.LineItems[e].Receipts.length;f++)d.push(a.LineItems[e].Receipts[f]);k.setAllReceipts(d),b.path("/submission")},a.deleteSubmission=function(b,d){g.setSubmissionIndex(d),i.setMessage("Are you sure you want to delete this submission?"),i.setBroadCastMessage("confirmFinanceDeleteSubmission"),i.setId(b.SubmissionId);c.open({templateUrl:"Views/HotTowel/views/modals/confirmModal.html",controller:"confirmModalController",resolve:{selectedType:function(){return a.selectedType}}})},a.$on("confirmFinanceDeleteSubmission",function(){i.setMessage(""),i.setBroadCastMessage(""),h.deleteExpenseReport(i.getId()).then(function(){a.financeSubmissions.splice(g.getSubmissionIndex(),1),g.setPendingSubmissionsByFinanceApprover(a.financeSubmissions)})})}]);