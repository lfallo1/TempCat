"use strict";angular.module("expenseApp.Controllers").controller("ManagerTableController",["$scope","$location","$modal","$route","$rootScope","$filter","Application","SubmissionService","MessageService","Authentication","ReceiptService",function(a,b,c,d,e,f,g,h,i,j,k){var l=f("orderBy"),m={field:"DateCreated",reverse:!1};a.expanded=!0,a.isManager=j.getIsManager(),a.managerOrder=function(b){b===m.field?(m.reverse=!m.reverse,a.managerSubmissions=l(a.managerSubmissions,m.field,m.reverse)):(m.field=b,m.reverse=!1,a.managerSubmissions=l(a.managerSubmissions,m.field,m.reverse))},a.expandContract=function(b){a.expanded=b},j.getIsManager()&&n();var n=function(){if(void 0!=g.getPendingSubmissionsByManagerName()){a.managerSubmissions=g.getPendingSubmissionsByManagerName(),e.$broadcast("managerTotal",a.managerSubmissions.length);for(var b=0;b<a.managerSubmissions.length;b++){for(var c=[],d=0;d<a.managerSubmissions[b].LineItems.length;d++)for(var f=0;f<a.managerSubmissions[b].LineItems[d].Receipts.length;f++)c.push(a.managerSubmissions[b].LineItems[d].Receipts[f]);a.managerSubmissions[b].allSubmissionReceipts=c}a.managerSubmissions[b].allSubmissionReceipts=c}else h.getPendingSubmissionsByManagerName().then(function(b){for(var c=b.data,d=0;d<c.length;d++){(4==c[d].StatusId||6==c[d].StatusId)&&rejected++;for(var f=[],h=0;h<c[d].LineItems.length;h++)for(var i=0;i<c[d].LineItems[h].Receipts.length;i++)f.push(c[d].LineItems[h].Receipts[i]);c[d].allSubmissionReceipts=f,c[d].ReceiptPresent=f.length>0?!0:!1}b.data.length>0&&g.setPendingSubmissionsByManagerName(c),a.managerSubmissions=c,e.$broadcast("managerTotal",a.managerSubmissions.length)})};a.loadManagerSubmission=function(a,c){g.setSubmission(a),g.setSubmissionStatus(a.Status.StatusId),g.setOrigin("ManagerTable"),g.setSubmissionIndex(c);for(var d=[],e=0;e<a.LineItems.length;e++)if(0!=a.LineItems[e].Receipts.length)for(var f=0;f<a.LineItems[e].Receipts.length;f++)d.push(a.LineItems[e].Receipts[f]);k.setAllReceipts(d),b.path("/submission")},a.deleteSubmission=function(b,d){g.setSubmissionIndex(d),i.setMessage("Are you sure you want to delete this submission?"),i.setBroadCastMessage("confirmManagerDeleteSubmission"),i.setId(b.SubmissionId);c.open({templateUrl:"Views/HotTowel/views/modals/confirmModal.html",controller:"confirmModalController",resolve:{selectedType:function(){return a.selectedType}}})},a.$on("confirmManagerDeleteSubmission",function(){i.setMessage(""),i.setBroadCastMessage(""),h.deleteExpenseReport(i.getId()).then(function(){a.managerSubmissions.splice(g.getSubmissionIndex(),1),g.setPendingSubmissionsByManagerName(a.managerSubmissions)})})}]);