"use strict";angular.module("expenseApp.Controllers").controller("ManagerTableController",["$scope","$location","$modal","$route","$rootScope","$filter","Application","SubmissionService","MessageService","Authentication","ReceiptService",function(a,b,c,d,e,f,g,h,i,j,k){a.isManager=j.getIsManager(),a.expanded=!0;var l=f("orderBy"),m={field:"DateCreated",reverse:!1};a.managerOrder=function(b){b===m.field?(m.reverse=!m.reverse,a.managerSubmissions=l(a.managerSubmissions,m.field,m.reverse)):(m.field=b,m.reverse=!1,a.managerSubmissions=l(a.managerSubmissions,m.field,m.reverse))},a.expandContract=function(b){a.expanded=b};j.getIsManager()&&(a.loadManagerTable=function(){void 0!=g.getPendingSubmissionsByManagerName()?(a.managerSubmissions=g.getPendingSubmissionsByManagerName(),e.$broadcast("managerTotal",a.managerSubmissions.length)):h.getPendingSubmissionsByManagerName().then(function(b){b.data.length>0&&g.setPendingSubmissionsByManagerName(b.data),a.managerSubmissions=b.data,e.$broadcast("managerTotal",a.managerSubmissions.length)},function(){})},a.loadManagerTable()),a.loadManagerSubmission=function(a,c){g.setSubmission(a),g.setSubmissionStatus(a.Status.StatusId),g.setOrigin("ManagerTable"),g.setSubmissionIndex(c);for(var d=[],e=0;e<a.LineItems.length;e++)if(0!=a.LineItems[e].Receipts.length)for(var f=0;f<a.LineItems[e].Receipts.length;f++)d.push(a.LineItems[e].Receipts[f]);k.setAllReceipts(d),b.path("/submission")},a.deleteSubmission=function(b,d){g.setSubmissionIndex(d),i.setMessage("Are you sure you want to delete this submission?"),i.setBroadCastMessage("confirmManagerDeleteSubmission"),i.setId(b.SubmissionId);c.open({templateUrl:"Views/HotTowel/views/modals/confirmModal.html",controller:"confirmModalController",resolve:{selectedType:function(){return a.selectedType}}})},a.$on("confirmManagerDeleteSubmission",function(){i.setMessage(""),i.setBroadCastMessage(""),h.deleteExpenseReport(i.getId()).then(function(){a.managerSubmissions.splice(g.getSubmissionIndex(),1),g.setPendingSubmissionsByManagerName(a.managerSubmissions)},function(){})})}]);